{% liquid
  assign s = section.settings
  assign alphabet = ''
  for block in section.blocks
    assign b = block.settings
    if b.title != blank
      assign first_letter = b.title | slice: 0
      unless alphabet contains first_letter
        assign alphabet = alphabet | append: '/' | append: first_letter
      endunless
    endif
  endfor
  assign alphabet = alphabet | split: '/' | sort_natural
%}

<section class="font-[RebondGrotesque] w-full max-w-[1120px] m-auto">
  <div class="py-7 md:py-14 text-center">
    <div class="md:pl-8 sticky top-0 mb-7">
      <div class="py-8 md:pr-8" style="background: rgb(var(--color-base-background-1))">
        <div class="ml-auto mr-auto max-w-2xl w-full">
          <div class="text-2xl flex flex-row flex-wrap gap-3 justify-center" data-alphabet>
            {% for letter in alphabet offset: 1 %}
              <a href="#letter-{{ letter }}" class="p-2 GroteskBold w-10 h-10 uppercase flex justify-center items-center font-bold rounded-full {%- unless forloop.first %} opacity-50{% else %} bg-yellow-100{% endunless %}">
                <span>{{ letter | upcase }}</span>
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    {% for letter in alphabet offset: 1 %}
      <div class="py-4 px-4 md:px-0">
        <div id="letter-{{ letter }}" class="flex flex-row items-center">
          <span class="GroteskBold font-bold text-lg md:text-4xl">{{ letter | upcase }}</span>
          <div class="w-full ml-4 border-acajou border-b border-dotted h-0"></div>
        </div>
        <div class="py-4 md:p-4 flex flex-row flex-wrap justify-center text-center">
          {% for block in section.blocks %}
            {% assign b = block.settings %}
            {% if b.title == blank %}
              {% break %}
            {% else %}
              {% assign first_letter = b.title | slice: 0 %}
              {% if first_letter == letter %}
                <a href="{{ b.link }}" class="py-4 px-2 md:p-4 w-1/3 md:w-1/6">
                  {% if b.image != blank %}
                    <div class="w-12 h-12 rounded-full overflow-hidden mb-2 ml-auto mr-auto">
                      <img src="{{ b.image | image_url: width: 150 }}"
                        loading="lazy"
                        class="object-cover h-full w-full"
                        alt="{{ b.image.alt }}"
                        width="{{ b.image.width }}"
                        height="{{ b.image.height }}">
                    </div>
                  {% endif %}
                  {% if b.title != blank %}
                    <{% if forloop.index < 4 %}h3{% else %}p{% endif %} class="font-[RebondGrotesque] font-medium text-sm md:text-xl mb-1 overflow-hidden w-full text-ellipsis">
                      {{ b.title }}
                    </{% if forloop.index < 4 %}h3{% else %}p{% endif %}>
                  {% endif %}
                </a>
              {% endif %}
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>
</section>

<script>
  const letters = document.querySelectorAll('[data-alphabet] a');
  if(letters.length > 0){
    letters.forEach((letter) => {
      letter.addEventListener('click', function(){
        letters.forEach((letter) => {
          letter.classList.remove("bg-yellow-100")
          letter.classList.add("opacity-50");
        });
        this.classList.add('bg-yellow-100');
        this.classList.remove('opacity-50');
      });
    })
  }
</script>

{% schema %}
  {
    "name": "Ingredients alphabet",
    "settings": [

    ],
    "blocks": [
      {
        "type": "ingredient",
        "name": "Ingredient",
        "settings": [
          {
            "type": "url",
            "id": "link",
            "label": "Url"
          },
          {
            "type": "image_picker",
            "id": "image",
            "label": "Image"
          },
          {
            "type": "text",
            "id": "title",
            "label": "Title",
            "default": "Amande Blanche"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Ingredients alphabet"
      }
    ]
  }
{% endschema %}

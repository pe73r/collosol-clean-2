<!DOCTYPE html>
<html lang="{{ locale }}" dir="{{ direction }}" class="{{ checkout_html_classes }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, user-scalable=0">
    <meta name="referrer" content="origin">

    <title>{{ page_title }}</title>

    {{ content_for_header }}

    {{ checkout_stylesheets }}
    {{ checkout_scripts }}

    <script src="{{ 'intlTelInput.min.js' | asset_url }}"></script>
    <link rel="stylesheet" href="{{ 'intlTelInput.min.css' | asset_url }}">

    <script>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-5PGRZQC');
    </script>

    <script>
      (function() {
        window.dataLayer = window.dataLayer || [];
        var items = [];

        if (sessionStorage.getItem("referrer_url") == null)
          sessionStorage.setItem("referrer_url", document.referrer);


        let template_name = '';


        {% liquid
            assign discount = 0
            assign coupons_items = checkout.discount_applications | where: 'target_type', 'line_item'
            assign coupons_shipping = checkout.discount_applications | where: 'target_type', 'shipping_line'
            assign shipping_discount = 0.00
            if coupons_shipping.size > 0
              assign shipping_discount = checkout.discounts_amount | divided_by: 100.00
            endif
          %}

        {% for line_item in checkout.line_items %}
          {%- liquid
              assign product = line_item.product
              assign total_discount = 0.00
              assign categories = "Boissons et infusions,Coaching,Compléments alimentaires,Ebook,Granolas et porridges,Gummies,Lots et packs,Pâte à tartiner,Snacks et Moonies" | split: ','
              for product_collection in product.collections
                for categorie in categories
                  if product_collection.title contains categorie
                    assign product_categorie = categorie
                    break
                  endif
                endfor
              endfor
              if product.compare_at_price > product.price
                assign product_discount = product.compare_at_price | minus: line_item.final_price
              else
                assign product_discount = 0.00
              endif
              assign total_discount = total_discount | plus: product_discount
            -%}items.push({
            item_id: '{{ line_item.sku }}',
            item_name: '{{ line_item.title | remove: "'" | remove: '"' }}',
            price: {{ line_item.final_price | divided_by: 100.00 }},
            item_category: '{{ product_categorie }}',
            quantity: {{ line_item.quantity }},
            discount: {{ product_discount | divided_by: 100.00 }}
          });{% endfor %}

          //Event add_shipping_info
          function contact_info(){
            dataLayer.push({
              'event': 'begin_checkout',
              'ecommerce': {
                'currency': 'EUR',
                'value' : {{ checkout.total_price | divided_by: 100.00 }},
                'discount' : {{ total_discount | divided_by: 100.00 }},
                'items': items
              }
            });
          }

          //Event add_shipping_info
          function add_shipping_info(){
            dataLayer.push({
              'event': 'add_shipping_info',
              'ecommerce': {
                'currency': 'EUR',
                'value' : {{ checkout.total_price | divided_by: 100.00 }},
                'discount' : {{ total_discount | divided_by: 100.00 }},
                'location_country' : '{{ checkout.shipping_address.country_code }}',
                'location_city' : '{{ checkout.shipping_address.city }}',
                'shipup_costs' : {{ checkout.shipping_price | divided_by: 100.00 }},
                'shipup_discount' : 0.00,
                'items': items
              }
            });
          }

          //Event add_payment_info
          function add_payment_info (){
            dataLayer.push({
              'event': 'add_payment_info',
              'ecommerce': {
                'currency': 'EUR',
                'value' : {{ checkout.total_price | divided_by: 100.00 }},
                'discount' : {{ total_discount | divided_by: 100.00 }},
                'location_country' : '{{ checkout.shipping_address.country_code }}',
                'location_city' : '{{ checkout.shipping_address.city }}',
                'shipup_costs' : {{ checkout.shipping_price | divided_by: 100.00 }},
                'shipup_discount' : {{ shipping_discount }},
                'payment_type' : '{{ checkout.transactions[0].gateway_display_name }}',
                'coupon_name' : '{% for discount in checkout.discount_applications %}{{ discount.title }}{% unless forloop.last %} / {% endunless %}{% endfor %}',
                'coupon_discount' : {{ checkout.discounts_amount | divided_by: 100.00 }},
                'tax' : {{ checkout.tax_price | divided_by: 100.00 }},
                'items': items
              }
            });
          }

          //Event add_payment_info
          function review (){
            dataLayer.push({
              'event': 'view_cart',
              'ecommerce': {
                'currency': 'EUR',
                'value' : {{ checkout.total_price | divided_by: 100.00 }},
                'discount' : {{ total_discount | divided_by: 100.00 }},
                'location_country' : '{{ checkout.shipping_address.country_code }}',
                'location_city' : '{{ checkout.shipping_address.city }}',
                'shipup_costs' : {{ checkout.shipping_price | divided_by: 100.00 }},
                'shipup_discount' : {{ shipping_discount }},
                'payment_type' : '{{ checkout.transactions[0].gateway_display_name }}',
                'coupon_name' : '{% for discount in checkout.discount_applications %}{{ discount.title }}{% unless forloop.last %} / {% endunless %}{% endfor %}',
                'coupon_discount' : {{ checkout.discounts_amount | divided_by: 100.00 }},
                'tax' : {{ checkout.tax_price | divided_by: 100.00 }},
                'items': items
              }
            });
          }


          if(Shopify.Checkout.step == "contact_information"){
            template_name = "Delivery page";
            contact_info();
          } else if(Shopify.Checkout.step == "shipping_method"){
            template_name = "Checkout shipping page";
            add_shipping_info();
          } else if(Shopify.Checkout.step == "payment_method"){
            template_name = "Checkout payment page";

            setTimeout(() => {

                const cardField = document.querySelector('[data-select-gateway="79946154230"] label')
                if(cardField){
                  cardField.click()

            }
            }, 100);
            add_payment_info();
          } else if(Shopify.Checkout.step == "review"){
            template_name = "Checkout review page";
            review();
          }

          if(template_name != ''){
            //Event page_view
            dataLayer.push({
              'event': 'page_view',
              'user_data': {
                'login_status': '{% if customer %}TRUE{% else %}FALSE{% endif %}',
                'newsletter_subscriber': {% if customer.accepts_marketing %}1{% else %}0{% endif %},
                'email': '{% if customer.email %}{{ customer.email }}{% endif %}',
              },
              'page_data': {
                'template': 'checkout',
                'url': '{{ shop.url }}{{ request.path }}',
                'referrer': sessionStorage.getItem("referrer_url"),
                'name': template_name,
                'title': template_name,
                'language': '{{ request.locale.iso_code | upcase }}',
                'country': '{{ request.locale.iso_code | upcase }}'
              }
            });
          }
        })();
        console.log('{{ checkout.shipping_address.phone }}')
      </script>
    {% render 'weglot_hreftags' %}
{% render 'weglot_switcher' %}
</head>
    {% render 'crosslog' %}
    <body>
      {{ skip_to_content_link }}

      <header class="banner" data-header role="banner">
        <div class="wrap">
          {{ content_for_logo }}
        </div>
      </header>

      {{ order_summary_toggle }}
      <div class="yotpo-widget-instance" data-yotpo-instance-id="274347"></div>
      <div class="content" data-content>
        <div class="wrap">
          <div class="main">
            <header class="main__header" role="banner">
              {{ content_for_logo }}
              <style>
                @media (max-width: 999px){
                  .breadcrumb__flex > *:not(nav) {
                    padding-bottom: 1.75em;
                    font-size: 0.8571428571em
                  }
                }
              </style>
              <div class="breadcrumb__flex">
                <a class="breadcrumb__link-home" href="/">Accueil</a>
                <svg class="icon-svg icon-svg--color-adaptive-light icon-svg--size-10 breadcrumb__chevron-icon" aria-hidden="true" focusable="false"> <use xlink:href="#chevron-right"></use> </svg>
                {{ breadcrumb }}
              </div>

              {{ alternative_payment_methods }}
            </header>

            <main class="main__content" role="main">
              {{ content_for_layout }}
            </main>
            <footer class="main__footer" role="contentinfo">
              {{ content_for_footer }}
            </footer>
          </div>
          <aside class="sidebar" role="complementary">
            <div class="sidebar__header">
              {{ content_for_logo }}
            </div>
            <div class="sidebar__content">
              {{ content_for_order_summary }}
              <div class="yotpo-widget-instance" data-yotpo-instance-id="274347"></div>
            </div>
          </aside>
        </div>
      </div>

      {{ tracking_code }}
      <script>
        let phone_input = document.querySelector('#checkout_shipping_address_phone');
        if(phone_input){
          const iti = window.intlTelInput(phone_input, {
            initialCountry: 'FR',
            separateDialCode: false,
            nationalMode: false,
            formatOnDisplay: true,
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.19/js/utils.min.js"
          });

          const dialCode = iti.getSelectedCountryData().dialCode;
          phone_input.value =  phone_input.value.charAt(0) !== '+' ? `+${dialCode}${phone_input.value.replace(' ', '')}` : phone_input.value.replace(' ', '');

          phone_input.addEventListener("countrychange", function() {
            dialCode = iti.getSelectedCountryData().dialCode;
            phone_input.value = `+${dialCode}${phone_input.value.replace(' ', '')}`;
          });
        }
      </script>
      <style>
        .product__description__property {
          display: none
        }
        .iti__flag {
          background-image: url("{{ 'flags.png' | asset_url }}");
        }

        .iti__flag-container {
          padding-top: 1.5em;
          padding-bottom: 0.3571428571em;
          padding-left: 6px;
        }

        .iti__selected-flag {
          background-color: transparent !important
        }


        #checkout_shipping_address_phone {
          padding-left: 62px !important
        }

        .iti__country-list {
          z-index: 3 !important
        }

        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
          .iti__flag {
            background-image: url("{{ 'flags@2x.png' | asset_url }}");
          }
        }

        .step__footer__previous-link{
          display: none;
        }
        .breadcrumb > .breadcrumb__item:first-child {
          display: none;
        }

      .breadcrumb__link-home {
        font-size: 12px;
        font-weight: 500;
      }
      .layout-flex__item a{
        background-color:#7b6047;
        padding: 8px 12px;
        padding-top: 0.5rem;
        color: #ffffff;
        font-size: 14px;
        font-weight: 400;
        border-radius: 25px;
        cursor: pointer;
      }
      .layout-flex__item > a:hover {
       color: #ffffff !important;
      }
      .layout-flex__item{
        margin: auto;
        margin-bottom: auto;
        margin-bottom: 20px;
      }

      #main-header{
        order: 2;
        width: 100%;

      }


      .section.section--payment-method .section__content fieldset{
        display: flex;
        flex-direction: column;
      }


    </style>

{% if  locale == "fr-FR"  %}


<style>
  /* carte */
  [data-select-gateway="85658599670"]{
        border-top: 0px !important;
        order:1;
      }
  [data-subfields-for-gateway="85658599670"]  {
        order:2;
      }
  /* paypal */
  [data-select-gateway="80406380790"]{
        border-top: 0px !important;
        order:3;
      }
  [data-subfields-for-gateway="80406380790"]  {
        order:4;
      }

  /* alma */
  [data-select-gateway="81396170998"]{
        border-top: 0px !important;
        order:5;
      }
  [data-subfields-for-gateway="81396170998"]  {
        order:6;
      }
  /* alma _ 2 */
  [data-select-gateway="81395974390"]{
        border-top: 0px !important;
        order:7;
      }
  [data-subfields-for-gateway="81395974390"]  {
        order:8;
      }



    /*GIROPAY */
  [data-select-gateway="85757952246"]{
        border-top: 0px !important;
        order:9;
      }
  [data-subfields-for-gateway="85757952246"]  {
        order:10;
      }

</style>

{% else %}


<style>

  /* paypal */
  [data-select-gateway="80406380790"]{
        border-top: 0px !important;
        order:1;
      }
  [data-subfields-for-gateway="80406380790"]  {
        order:2;
      }

  /* alma */
  [data-select-gateway="81396170998"]{
        border-top: 0px !important;
        order:3;
      }
  [data-subfields-for-gateway="81396170998"]  {
        order:4;
      }
      /* carte */
  [data-select-gateway="85658599670"]{
    border-top: 0px !important;
    order:5;
  }
[data-subfields-for-gateway="85658599670"]  {
    order:6;
  }
  /* alma _ 2 */
  [data-select-gateway="81395974390"]{
        border-top: 0px !important;
        order:7;
      }
  [data-subfields-for-gateway="81395974390"]  {
        order:8;
      }
    /*GIROPAY */
    [data-select-gateway="85757952246"]{
      border-top: 0px !important;
      order: 11;
    }
[data-subfields-for-gateway="85757952246"]  {
      order:12;
    }

</style>

{% endif %}

    <script src="https://cdn-widgetsrepository.yotpo.com/v1/loader/ls8PaM3V_SQAYEemet-bbw" async></script>

  </body>
</html>
